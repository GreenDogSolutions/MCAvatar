<?php
 class MCAvatar{private $a='';private $b='';private $c='';private $d='';private $g=array();private $h=8;private $k=8;private $l=8;private $m=8;private $n=64;private $o=64;public function __construct($p,$c,$d,$q=''){$this->membersxml=$p;$this->tmppath=$c;$this->avatarimagepath=$d;$this->pagenotice=$q;}public function mca_set_image_settings($r=8,$s=8,$t=8,$u=8,$v=64,$w=64){$this->top=$s;$this->left=$r;$this->crop_width=$t;$this->crop_height=$u;$this->new_width=$v;$this->new_height=$w;}public function mca_update_avatars(){$x=$this->_mca_get_users();foreach($x as $y=>$z){foreach($z as $aa){$this->_mca_extract_userskin($aa);}}}public function mca_update_user_avatar($bb){return $this->_mca_extract_userskin($bb);}public function mca_build_page(){$x=$this->_mca_get_users();$cc='';foreach($x as $dd=>$ee){$cc.='<p class="member-list-title '.$dd.'s">'.ucfirst($dd).'s</p>';foreach($ee as $aa){$cc.='<div class="member server-member"><img class="membertile" alt="'.$aa.'" src="/'.$this->avatarimagepath.'/'.$aa.'.jpg" /><br />'.ucfirst(strtolower($aa)).'</div>';}}if($this->pagenotice!=''){$cc.='<div class="members-notice">'.$this->pagenotice.'</div>';}$this->_mca_add_message('Avatar page built successfully.');return $cc;}public function mca_messages(){return $this->messages;}private function _mca_get_users(){$ff=array();$gg=new DOMDocument();$gg->load($this->membersxml);foreach($gg->getElementsByTagName('ugroup')as $dd){$ff[$dd->nodeValue]=array();foreach($gg->getElementsByTagName($dd->nodeValue)as $aa){array_push($ff[$dd->nodeValue],$aa->nodeValue);}usort($ff[$dd->nodeValue],'strnatcasecmp');}unset($gg);return $ff;}private function _mca_extract_userskin($bb){$this->_mca_add_message('Attempting to create Usertile for "'.$bb.'" ...');try{$hh='http://skins.minecraft.net/MinecraftSkins/'.$bb.'.png';$ii=filter_input(INPUT_SERVER,'DOCUMENT_ROOT').'/'.$this->tmppath.'/mca_tmp.png';$jj=filter_input(INPUT_SERVER,'DOCUMENT_ROOT').'/'.$this->avatarimagepath.'/'.$bb.'.jpg';$kk=false;if($ll=file_get_contents($hh)){$kk=file_put_contents($ii,$ll);}if($kk){$mm=imagecreatetruecolor($this->crop_width,$this->crop_height);$nn=imagecreatefrompng($ii);imagecopy($mm,$nn,0,0,$this->left,$this->top,64,32);if($this->_mca_check_transparent($nn)){imagecopy($mm,$nn,0,0,$this->left+32,$this->top,64,32);}$oo=imagecreate($this->new_width,$this->new_height);imagecopyresized($oo,$mm,0,0,0,0,$this->new_width,$this->new_height,$this->crop_width,$this->crop_height);imagejpeg($oo,$jj,100);$this->_mca_add_message('Avatar created for "'.$bb.'" in "'.$jj.'".','notice');unset($kk);unset($mm);unset($oo);unset($nn);return'/'.$this->avatarimagepath.'/'.$bb.'.jpg';}else{$this->_mca_add_message('Unable to get skin for "'.$bb.'"!','error');return'';}}catch(Exception $pp){$this->_mca_add_message('Unable to create avatar for "'.$bb.'"! '.$pp->getMessage(),'error');return'';}}private function _mca_add_message($qq,$rr='notice'){array_push($this->messages,array('weight'=>$rr,'message'=>$qq));}private function _mca_check_transparent($ss){$tt=imagesx($ss);$uu=imagesy($ss);for($vv=0;$vv<$tt;$vv++){for($ww=0;$ww<$uu;$ww++){$xx=imagecolorat($ss,$vv,$ww);if(($xx&0x7F000000)>>24){return true;}}}return false;}}?>